<style>
.biao-popup{
    position: fixed;
  z-index: 1000;
  background: #fff;
  padding: 10px;
  border: 4px solid;
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, .1);
  -moz-box-shadow: 0 1px 5px rgba(0, 0, 0, .1);
  box-shadow: 0 1px 5px rgba(0, 0, 0, .1);
}

.biao-mask {
  position: fixed;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  background: rgba(0, 0, 0, .6);
  z-index: 999;
}





</style>


<!--用户HTML开始-->
<button id="trigger">收藏</button>
<div id="popup">
  确定要收藏吗？
  <img src="http://dummyimage.com/200x200">
</div>

<div>
  Lorem ipsum dolor sit amet, consectetur adipisicing elit. Facere inventore maiores nam natus necessitatibus nihil
  quasi quibusdam sit tempora, vel? Dolores eos est itaque, laborum numquam obcaecati vitae voluptate voluptatibus!
  Lorem ipsum dolor sit amet, consectetur adipisicing elit. Facere inventore maiores nam natus necessitatibus nihil
  quasi quibusdam sit tempora, vel? Dolores eos est itaque, laborum numquam obcaecati vitae voluptate voluptatibus!
  Lorem ipsum dolor sit amet, consectetur adipisicing elit. Facere inventore maiores nam natus necessitatibus nihil
  quasi quibusdam sit tempora, vel? Dolores eos est itaque, laborum numquam obcaecati vitae voluptate voluptatibus!
  Lorem ipsum dolor sit amet, consectetur adipisicing elit. Facere inventore maiores nam natus necessitatibus nihil
  quasi quibusdam sit tempora, vel? Dolores eos est itaque, laborum numquam obcaecati vitae voluptate voluptatibus!
  Lorem ipsum dolor sit amet, consectetur adipisicing elit. Facere inventore maiores nam natus necessitatibus nihil
  quasi quibusdam sit tempora, vel? Dolores eos est itaque, laborum numquam obcaecati vitae voluptate voluptatibus!
  Lorem ipsum dolor sit amet, consectetur adipisicing elit. Facere inventore maiores nam natus necessitatibus nihil
  quasi quibusdam sit tempora, vel? Dolores eos est itaque, laborum numquam obcaecati vitae voluptate voluptatibus!
  Lorem ipsum dolor sit amet, consectetur adipisicing elit. Facere inventore maiores nam natus necessitatibus nihil
  quasi quibusdam sit tempora, vel? Dolores eos est itaque, laborum numquam obcaecati vitae voluptate voluptatibus!
  Lorem ipsum dolor sit amet, consectetur adipisicing elit. Consectetur corporis debitis dolore ducimus eaque ex id,
  ipsa itaque modi nisi, odit optio perspiciatis quos recusandae reiciendis tempore vel voluptatem, voluptates.
  Lorem ipsum dolor sit amet, consectetur adipisicing elit. Consectetur corporis debitis dolore ducimus eaque ex id,
  ipsa itaque modi nisi, odit optio perspiciatis quos recusandae reiciendis tempore vel voluptatem, voluptates.
  Lorem ipsum dolor sit amet, consectetur adipisicing elit. Consectetur corporis debitis dolore ducimus eaque ex id,
  ipsa itaque modi nisi, odit optio perspiciatis quos recusandae reiciendis tempore vel voluptatem, voluptates.
  Lorem ipsum dolor sit amet, consectetur adipisicing elit. Consectetur corporis debitis dolore ducimus eaque ex id,
  ipsa itaque modi nisi, odit optio perspiciatis quos recusandae reiciendis tempore vel voluptatem, voluptates.
  Lorem ipsum dolor sit amet, consectetur adipisicing elit. Consectetur corporis debitis dolore ducimus eaque ex id,
  ipsa itaque modi nisi, odit optio perspiciatis quos recusandae reiciendis tempore vel voluptatem, voluptates.
  Lorem ipsum dolor sit amet, consectetur adipisicing elit. Consectetur corporis debitis dolore ducimus eaque ex id,
  ipsa itaque modi nisi, odit optio perspiciatis quos recusandae reiciendis tempore vel voluptatem, voluptates.
  Lorem ipsum dolor sit amet, consectetur adipisicing elit. Consectetur corporis debitis dolore ducimus eaque ex id,
  ipsa itaque modi nisi, odit optio perspiciatis quos recusandae reiciendis tempore vel voluptatem, voluptates.
  Lorem ipsum dolor sit amet, consectetur adipisicing elit. Consectetur corporis debitis dolore ducimus eaque ex id,
  ipsa itaque modi nisi, odit optio perspiciatis quos recusandae reiciendis tempore vel voluptatem, voluptates.
  Lorem ipsum dolor sit amet, consectetur adipisicing elit. Consectetur corporis debitis dolore ducimus eaque ex id,
  ipsa itaque modi nisi, odit optio perspiciatis quos recusandae reiciendis tempore vel voluptatem, voluptates.
</div>
<!--用户HTML结束-->

<script>
let trigger,popup,mask
boot('#trigger','#popup');

/**
 * 设置必要的弹出层信息
 * @param {string} triggerSelector 点谁弹出（选择器）
 * @param {string} popupSelector 弹出谁（选择器）
 */
function boot(triggerSelector,popupSelector){
    trigger=document.querySelector(triggerSelector)
    popup=document.querySelector(popupSelector)
    //准备popup
    initPopup();
    //准备mask
    initMask();
    //绑定打开相关事件
    bindOpen();
    //绑定关闭相关事件
    bindClose();
}

function bindClose(){
    mask.addEventListener('click',()=>{
        mask.hidden=popup.hidden=true;
    })

    document.body.addEventListener('keyup',(e)=>{
       if(e.code==="Escape")
       mask.hidden=popup.hidden=true;
    })
}


function bindOpen(){
    trigger.addEventListener('click',()=>{
        //mask与popup显示
        mask.hidden=popup.hidden=false;

        //将popup定位到合适的位置
        repositionPopup('center',-30)
    })
}

function initPopup(){
    // 添加插件专属类
    popup.classList.add('biao-popup');

    //一开始popup需要隐藏
    popup.hidden=true;

}

function initMask(){
    //创建一个新元素
    mask=document.createElement('div')
    //添加插件专属类
    mask.classList.add('biao-mask')
    //将这个类添加到最后
    document.body.appendChild(mask);
    //一开始mask将隐藏
    mask.hidden=true
}


function repositionPopup(position='center',xOffset=0,yOffset=0){

//浏览器窗口尺寸
    let windowWidth =window.innerWidth
    let windowHeight=window.innerHeight
//元素本身尺寸
    let width=popup.offsetWidth
    let height=popup.offsetHeight

//默认使元素在页面中居中
    popup.style.left=windowWidth/2-width/2+xOffset+'px'
    popup.style.top=windowHeight/2-width/2+yOffset+'px'
}
</script>

